<?xml version="1.0" encoding="UTF-8"?>
<Configuration name="localKoski" status="INFO" packages="io.prometheus.client.log4j2, fi.oph.koski.log">
  <!--

    Loggers

  -->
  <Loggers>
    <!-- Root logger -->
    <Root level="INFO">
      <AppenderRef ref="Console"/>
      <AppenderRef ref="ApplicationLog" />
      <AppenderRef ref="Prometheus" />
    </Root>
    <!-- Access log -->
    <Logger name="org.eclipse.jetty.server.RequestLog" level="INFO" additivity="false">
      <AppenderRef ref="AccessLog" />
    </Logger>
    <!-- Audit log -->
    <Logger name="fi.vm.sade.auditlog.Audit" level="INFO" additivity="false">
      <AppenderRef ref="AuditLog" />
    </Logger>
    <!-- Performance log -->
    <Logger name="fi.oph.koski.util.Timer" level="INFO" additivity="false">
      <AppenderRef ref="PerformanceLog" />
    </Logger>
    <!-- HTTP client log-->
    <Logger name="fi.oph.koski.http.Http" level="DEBUG" additivity="false">
      <AppenderRef ref="HttpClientLog" />
    </Logger>
    <!-- IP tracking log -->
    <Logger name="fi.oph.koski.tiedonsiirto.IPTracking" level="INFO" additivity="false">
      <AppenderRef ref="IpTrackingLog" />
    </Logger>
    <!-- Content-Security-Policy reporting logs -->
    <Logger name="fi.oph.koski.frontendvalvonta.ReportUriService" level="INFO" additivity="false">
      <AppenderRef ref="ReportUriLog" />
    </Logger>
    <Logger name="fi.oph.koski.frontendvalvonta.ReportToService" level="INFO" additivity="false">
      <AppenderRef ref="ReportToLog" />
    </Logger>
    <!-- Slick: set level to DEBUG to see the SQL generated by Slick -->
    <Logger name="slick.jdbc.JdbcBackend.statement" level="INFO" />
    <!-- Silence noise from Jetty writer -->
    <Logger name="org.eclipse.jetty.server.HttpChannel" level="ERROR" />
  </Loggers>
  <!--

    Appenders

    K채yt채 pattern layouteissa viestien formatointiin %cm, jos haluat ett채 siit채 maskataan hetut piiloon.

  -->
  <Appenders>
    <!-- Console -->
    <Console name="Console">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1} - %cm%n"/>
    </Console>
    <!-- Application log file -->
    <RollingFile name="ApplicationLog" fileName="log/koski.log" filePattern="log/koski.log.%d{yyyy-MM}.zip" append="false">
      <JsonTemplateLayout eventTemplateUri="classpath:MaskedLogstashJsonEventLayoutV1.json">
        <EventTemplateAdditionalField key="log_type" value="app" />
      </JsonTemplateLayout>
      <TimeBasedTriggeringPolicy />
    </RollingFile>
    <!-- Access log -->
    <File name="AccessLog" fileName="log/koski-access.log" append="false">
      <PatternLayout pattern="%cm%n" />
    </File>
    <!-- Audit log file -->
    <File name="AuditLog" fileName="log/koski-audit.log" append="false">
      <PatternLayout pattern="%m%n" />
    </File>
    <!-- Performance log file -->
    <RollingFile name="PerformanceLog" fileName="log/koski-performance.log" filePattern="log/koski-performance.log.%d{yyyy-MM}.zip">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} %-5p %cm%n" />
      <TimeBasedTriggeringPolicy />
    </RollingFile>
    <!-- HTTP client log file -->
    <RollingFile name="HttpClientLog" fileName="log/koski-httpclient.log" filePattern="log/koski-httpclient.log.%d{yyyy-MM}.zip">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} %cm%n" />
      <TimeBasedTriggeringPolicy />
    </RollingFile>
    <!-- IP tracking log -->
    <RollingFile name="IpTrackingLog" fileName="log/koski-ip-tracking.log" filePattern="log/koski-ip-tracking.log.%d{yyyy-MM}.zip">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} %cm%n" />
      <TimeBasedTriggeringPolicy />
    </RollingFile>
    <!-- Content-Security-Policy reporting logs -->
    <File name="ReportUriLog" fileName="log/koski-report-uri.log" append="false">
      <PatternLayout pattern="%m%n" />
    </File>
    <File name="ReportToLog" fileName="log/koski-report-to.log" append="false">
      <PatternLayout pattern="%m%n" />
    </File>
    <!-- Prometheus -->
    <Prometheus name="Prometheus" />
  </Appenders>
</Configuration>
