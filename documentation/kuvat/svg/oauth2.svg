<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="786px" preserveAspectRatio="none" style="width:1422px;height:786px;background:#FFFFFF;" version="1.1" viewBox="0 0 1422 786" width="1422px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="286" x="561.08" y="22.9951">OAuth2 -workflow KOSKI-palvelussa</text><!--cluster KOSKI--><g id="cluster_KOSKI"><path d="M274.66,477.2969 L323.66,477.2969 A3.75,3.75 0 0 1 326.16,479.7969 L333.16,499.5938 L563.66,499.5938 A2.5,2.5 0 0 1 566.16,502.0938 L566.16,776.7969 A2.5,2.5 0 0 1 563.66,779.2969 L274.66,779.2969 A2.5,2.5 0 0 1 272.16,776.7969 L272.16,479.7969 A2.5,2.5 0 0 1 274.66,477.2969 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="272.16" x2="333.16" y1="499.5938" y2="499.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="48" x="276.16" y="492.292">KOSKI</text></g><!--entity koski_backend--><g id="elem_koski_backend"><rect fill="#F1F1F1" height="95.1875" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="261" x="288.66" y="668.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="529.66" y="673.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="527.66" y="675.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="527.66" y="679.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="303.66" y="701.292">KOSKI-backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="303.66" y="717.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="221" x="303.66" y="733.8857">"OAuth 2.0 Authorization server"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201" x="303.66" y="750.1826">"OAuth 2.0  Resource server"</text></g><!--entity luovutuspalvelu--><g id="elem_luovutuspalvelu"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="261" x="288.66" y="512.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="529.66" y="517.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="527.66" y="519.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="527.66" y="523.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="195" x="303.66" y="545.292">KOSKI-luovutuspalvelu-nginx</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="303.66" y="561.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="221" x="303.66" y="577.8857">Mutual TLS client cert -tunnistus</text></g><g id="elem_intro"><path d="M1135.66,71.2969 L1135.66,96.4297 L1354.66,96.4297 L1354.66,81.2969 L1344.66,71.2969 L1135.66,71.2969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1344.66,71.2969 L1344.66,81.2969 L1354.66,81.2969 L1344.66,71.2969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="1141.66" y="88.3638">Ks. /documentation/oauth2.md</text></g><!--entity user--><g id="elem_user"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="155" x="935.66" y="44.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1070.66" y="49.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1068.66" y="51.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1068.66" y="55.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="53" x="950.66" y="77.292">K&#228;ytt&#228;j&#228;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="950.66" y="93.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="950.66" y="109.8857">"OAuth 2.0 User"</text></g><!--entity user_agent--><g id="elem_user_agent"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199" x="913.66" y="260.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1092.66" y="265.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1090.66" y="267.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1090.66" y="271.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="928.66" y="293.292">Web-selain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="928.66" y="309.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159" x="928.66" y="325.8857">"OAuth 2.0 User agent"</text></g><!--entity client--><g id="elem_client"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="180" x="314.16" y="260.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="474.16" y="265.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="472.16" y="267.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="472.16" y="271.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140" x="329.16" y="293.292">Hy&#246;dynt&#228;j&#228;-backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="329.16" y="309.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="329.16" y="325.8857">"OAuth 2.0 Client"</text></g><!--link luovutuspalvelu to koski_backend--><g id="link_luovutuspalvelu_koski_backend"><path codeLine="42" d="M419.16,591.5969 C419.16,614.6269 419.16,637.9669 419.16,662.2369 " fill="none" id="luovutuspalvelu-to-koski_backend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="419.16,668.2369,423.16,659.2369,419.16,663.2369,415.16,659.2369,419.16,668.2369" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="420.16" y="634.3638">5, 6 edelleenv&#228;litys</text></g><!--link client to user_agent--><g id="link_client_user_agent"><path codeLine="44" d="M494.35,299.7969 C606.43,299.7969 791.08,299.7969 907.42,299.7969 " fill="none" id="client-to-user_agent" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="913.42,299.7969,904.42,295.7969,908.42,299.7969,904.42,303.7969,913.42,299.7969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="517.41" y="262.8638">1. Avaa k&#228;ytt&#228;j&#228;lle Kosken tarjoama tietojen luovutus -sivu</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="701.91" y="277.9966">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="548.41" y="293.1294">{client_id, redirect_uri, code_challenge, [scope]}</text></g><!--link user to user_agent--><g id="link_user_user_agent"><path codeLine="45" d="M1013.16,123.5469 C1013.16,162.2169 1013.16,215.2769 1013.16,253.9669 " fill="none" id="user-to-user_agent" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1013.16,259.9669,1017.16,250.9669,1013.16,254.9669,1009.16,250.9669,1013.16,259.9669" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="1023.16" y="166.3638">2. Tee KOSKI-login + k&#228;ytt&#246;liittym&#228;n kautta</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293" x="1014.16" y="181.4966">mahdolliset lis&#228;rajoitukset jaettavalle sis&#228;ll&#246;lle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="1038.16" y="196.6294">ja anna lupa clientille tietojen k&#228;ytt&#246;&#246;n</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1158.66" y="211.7622">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="1107.66" y="226.895">{user-id, scope}</text></g><!--link user_agent to koski_backend--><g id="link_user_agent_koski_backend"><path codeLine="46" d="M1009.44,339.3469 C1001.3,401.7369 976.19,524.5769 901.16,591.2969 C849.52,637.2169 680.0652,672.9716 555.7952,694.0916 " fill="none" id="user_agent-to-koski_backend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="549.88,695.0969,559.423,697.5324,554.8093,694.2591,558.0826,689.6455,549.88,695.0969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="1142.66" y="526.3638">3. L&#228;het&#228; pyynt&#246;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="1090.16" y="541.4966">"authorization code":n luomiseksi</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1194.16" y="556.6294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="1043.16" y="571.7622">{user-id, response_type=code, client_id, scope,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="436" x="978.16" y="586.895">redirect_uri, state, code_challenge, code_challenge_method=S256}</text></g><!--link koski_backend to client--><g id="link_koski_backend_client"><path codeLine="47" d="M519.82,668.2869 C532.44,659.5669 544.35,649.5769 554.16,638.2969 C557.16,634.8469 677.99,442.4369 624.16,369.2969 C594.4,328.8669 546.8824,312.5049 500.1124,305.4249 " fill="none" id="koski_backend-to-client" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="494.18,304.5269,502.4799,309.8289,499.1237,305.2752,503.6773,301.919,494.18,304.5269" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="631.16" y="533.8638">4. L&#228;het&#228; generoitu "authorization code"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="669.16" y="548.9966">selaimen redirecti&#228; k&#228;ytt&#228;en</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="758.16" y="564.1294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="676.16" y="579.2622">{redirect_uri, state, code}</text></g><!--link client to luovutuspalvelu--><g id="link_client_luovutuspalvelu"><path codeLine="48" d="M314.14,304.5469 C215.75,310.7469 67.35,327.0369 32.16,369.2969 C6,400.7169 6.71,429.2969 32.16,461.2969 C64.03,501.3769 183.1893,524.3093 282.6593,537.1393 " fill="none" id="client-to-luovutuspalvelu" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="288.61,537.9069,280.1956,532.7884,283.6511,537.2673,279.1722,540.7227,288.61,537.9069" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="96.16" y="382.3638">5. Vaihda "authorization code"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="136.66" y="397.4966">"access token":iin</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="190.66" y="412.6294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="33.16" y="427.7622">{mtls-client-cert, grant_type=authorization_code,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="98.66" y="442.895">client_id, code, code_verifier}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="77.16" y="458.0278">=&gt; {access_token, [refresh_token]}</text></g><!--link client to luovutuspalvelu--><g id="link_client_luovutuspalvelu"><path codeLine="49" d="M403.49,339.5569 C403.36,349.2669 403.23,359.6669 403.16,369.2969 C402.86,410.1869 399.55,420.5669 403.16,461.2969 C404.65,478.1169 406.5537,490.6255 409.5837,506.3355 " fill="none" id="client-to-luovutuspalvelu-1" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="410.72,512.2269,412.9432,502.6322,409.7731,507.3174,405.088,504.1473,410.72,512.2269" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="448.16" y="389.8638">6. Hae jaetut tiedot</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="454.16" y="404.9966">"access token":lla</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="508.16" y="420.1294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="408.16" y="435.2622">{mtls-client-cert, access_token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="476.66" y="450.395">=&gt; {data}</text></g><!--SRC=[XLJDRfj04Bxp52DVQqZhDZbOIgIebrHE6wb9sqE8q0GczffbrzfTdBgHtyRFu1VWnJeBs0N7KM-mE_FzpO0JJXBSN9PkDeBmMPlyIUfdcDpSJhw42vHBagMr60JVj2D02q8vemEOs0XECfsM1Ic7JcXrej63H4KMaCf0SNqGB33DSKeD7hm4GQgBXLRS0xcskKWUkS2NtmVGahOd0HyCQbqmYjw3Vz16_Acfm99PaXdqI-0xMLsQbFRN3rq-MUfbwKhRckem7jo4QYhKRy__bKzHmjtrBQHIU92KZ8FGbKe9onsUOTqbAPcwGQusA-UgpRpQ73ZvOLz9yrq9nyIFllSNFOQM90frf1NgkWE0LfrllbfLssob6ketmlnSbzSOXwc4cNvMuSN1TCPmEeGpe8oa95BBQYE5MrcMq11pGyV363v4SBb4XFnV2jm84mOb1GxDN6E1u0GvFUUJdGe8hLYMiOhLIuESY6m8XZ9XA7L9QSGGKfrHaiwG0TMKXd1lKxsWXtLGPnyUIXb5S4UqcxJcqSAxdQwj5CAvLL5j5EIylGvZLU0iqr8AIxmombORWtCjN9dxWpaI5oqzDrX_AIM3I8hL706LGdQom7OSmbVjBUuegwsg_NcHeNTNos_KjwAFnFynWkjgCoFE4XOhFzvjh0RO-oXyC8Dn7MR1ydCh-aI6BA-BfSIj5dJkguVGIRdMCOnLFstB7pUz3ht_dXJ4GhBpsz7fsJheQ_S3QRTa39ywDjWg6Pyi7FCHg_eBuB_BVlo2ctOBHKs8RsfTxpUJwGztdBSvWfyePXc-mJt0D2LhmMdsC1WBqT0LJjgm0Gxzds08KuCSNnre3oYfuurL9zysS1yS_vp4ao2pZXMSNy1BmvRKRBpGXfvuLhFc_U4_LiuYk4AgDxDqVjqoxLuPa1Az0JZYeCkzqvEXmtNm5m00]--></g></svg>