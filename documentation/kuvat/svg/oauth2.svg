<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="771px" preserveAspectRatio="none" style="width:1459px;height:771px;background:#FFFFFF;" version="1.1" viewBox="0 0 1459 771" width="1459px" zoomAndPan="magnify"><title>OAuth2 -workflow KOSKI-palvelussa</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="285.3389" x="579.9761" y="22.9951">OAuth2 -workflow KOSKI-palvelussa</text><!--cluster KOSKI--><g id="cluster_KOSKI"><path d="M274.67,462.2969 L324.5606,462.2969 A3.75,3.75 0 0 1 327.0606,464.7969 L334.0606,484.5938 L571.67,484.5938 A2.5,2.5 0 0 1 574.17,487.0938 L574.17,761.7969 A2.5,2.5 0 0 1 571.67,764.2969 L274.67,764.2969 A2.5,2.5 0 0 1 272.17,761.7969 L272.17,464.7969 A2.5,2.5 0 0 1 274.67,462.2969 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><line style="stroke:#000000;stroke-width:1.5;" x1="272.17" x2="334.0606" y1="484.5938" y2="484.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="48.8906" x="276.17" y="477.292">KOSKI</text></g><!--entity koski_backend--><g id="elem_koski_backend"><rect fill="#F1F1F1" height="95.1875" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="270.4121" x="288.17" y="653.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="538.5821" y="658.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="536.5821" y="660.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="536.5821" y="664.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107.0918" x="303.17" y="686.292">KOSKI-backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="303.17" y="702.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="230.4121" x="303.17" y="718.8857">"OAuth 2.0 Authorization server"</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="206.2334" x="303.17" y="735.1826">"OAuth 2.0  Resource server"</text></g><!--entity luovutuspalvelu--><g id="elem_luovutuspalvelu"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="266.8301" x="288.67" y="497.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="535.5001" y="502.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="533.5001" y="504.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="533.5001" y="508.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="202.4668" x="303.67" y="530.292">KOSKI-luovutuspalvelu-nginx</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="303.67" y="546.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="226.8301" x="303.67" y="562.8857">Mutual TLS client cert -tunnistus</text></g><g id="elem_intro"><path d="M1145.67,71.2969 L1145.67,96.4297 L1368.2652,96.4297 L1368.2652,81.2969 L1358.2652,71.2969 L1145.67,71.2969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1358.2652,71.2969 L1358.2652,81.2969 L1368.2652,81.2969 L1358.2652,71.2969 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.5952" x="1151.67" y="88.3638">Ks. /documentation/oauth2.md</text></g><!--entity user--><g id="elem_user"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="159.7861" x="945.17" y="44.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1084.9561" y="49.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1082.9561" y="51.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1082.9561" y="55.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58.0713" x="960.17" y="77.292">K&#228;ytt&#228;j&#228;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="960.17" y="93.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.7861" x="960.17" y="109.8857">"OAuth 2.0 User"</text></g><!--entity user_agent--><g id="elem_user_agent"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="204.6777" x="922.67" y="245.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="1107.3477" y="250.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1105.3477" y="252.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="1105.3477" y="256.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="77.5332" x="937.67" y="278.292">Web-selain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="937.67" y="294.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164.6777" x="937.67" y="310.8857">"OAuth 2.0 User agent"</text></g><!--entity client--><g id="elem_client"><rect fill="#F1F1F1" height="78.8906" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="184.6553" x="311.67" y="245.2969"/><rect fill="#F1F1F1" height="10" style="stroke:#181818;stroke-width:0.5;" width="15" x="476.3253" y="250.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="474.3253" y="252.2969"/><rect fill="#F1F1F1" height="2" style="stroke:#181818;stroke-width:0.5;" width="4" x="474.3253" y="256.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="144.6553" x="326.67" y="278.292">Hy&#246;dynt&#228;j&#228;-backend</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4.4502" x="326.67" y="294.5889">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128.4063" x="326.67" y="310.8857">"OAuth 2.0 Client"</text></g><!--link luovutuspalvelu to koski_backend--><g id="link_luovutuspalvelu_koski_backend"><path codeLine="42" d="M422.41,576.5969 C422.55,599.6269 422.6929,622.967 422.8429,647.237 " fill="none" id="luovutuspalvelu-to-koski_backend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="422.88,653.2369,426.8243,644.2123,422.8491,648.237,418.8245,644.2618,422.88,653.2369" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127.0928" x="423.17" y="619.3638">5, 6 edelleenv&#228;litys</text></g><!--link client to user_agent--><g id="link_client_user_agent"><path codeLine="44" d="M496.8,284.7969 C610.92,284.7969 798.17,284.7969 916.65,284.7969 " fill="none" id="client-to-user_agent" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="922.65,284.7969,913.65,280.7969,917.65,284.7969,913.65,288.7969,922.65,284.7969" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="384.0459" x="517.67" y="247.8638">1. Avaa k&#228;ytt&#228;j&#228;lle Kosken tarjoama tietojen luovutus -sivu</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="707.6268" y="262.9966">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360.2739" x="529.556" y="278.1294">{client_id, redirect_uri, code_challenge, scope, [state]}</text></g><!--link user to user_agent--><g id="link_user_user_agent"><path codeLine="45" d="M1025.17,123.6369 C1025.17,158.7069 1025.17,204.0169 1025.17,239.0569 " fill="none" id="user-to-user_agent" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1025.17,245.0569,1029.17,236.0569,1025.17,240.0569,1021.17,236.0569,1025.17,245.0569" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368.9004" x="1026.17" y="166.3638">2. Tee KOSKI-login + k&#228;ytt&#246;liittym&#228;n kautta ja anna lupa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169.9395" x="1125.6505" y="181.4966">clientille tietojen k&#228;ytt&#246;&#246;n</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1208.554" y="196.6294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.4517" x="1179.8944" y="211.7622">{user-id}</text></g><!--link user_agent to koski_backend--><g id="link_user_agent_koski_backend"><path codeLine="46" d="M1023.23,324.3169 C1017.96,386.6769 998.32,509.4769 925.17,576.2969 C871.99,624.8769 694.0982,660.1616 564.3582,680.4116 " fill="none" id="user_agent-to-koski_backend" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="558.43,681.3369,567.9392,683.9011,563.3702,680.5658,566.7055,675.9968,558.43,681.3369" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.1064" x="1169.6773" y="511.3638">3. L&#228;het&#228; pyynt&#246;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.1021" x="1115.1795" y="526.4966">"authorization code":n luomiseksi</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1222.6644" y="541.6294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311.416" x="1069.0225" y="556.7622">{user-id, response_type=code, client_id, scope,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="453.1211" x="998.17" y="571.895">redirect_uri, code_challenge, code_challenge_method=S256, [state]}</text></g><!--link koski_backend to client--><g id="link_koski_backend_client"><path codeLine="47" d="M527.42,653.0969 C539.89,644.4669 551.57,634.5569 561.17,623.2969 C566.3,617.2769 676.18,423.5169 625.17,354.2969 C595.74,314.3569 549.198,297.9438 502.768,290.6838 " fill="none" id="koski_backend-to-client" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="496.84,289.7569,505.114,295.0992,501.78,290.5293,506.3499,287.1953,496.84,289.7569" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.6304" x="640.6759" y="518.8638">4. L&#228;het&#228; generoitu "authorization code"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.6421" x="632.17" y="533.9966">selaimesta tulevana form post -responsena</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="771.4249" y="549.1294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.9873" x="682.4974" y="564.2622">{redirect_uri, code, [state]}</text></g><!--link client to luovutuspalvelu--><g id="link_client_luovutuspalvelu"><path codeLine="48" d="M311.49,289.7169 C213.11,296.0469 67.04,312.4069 32.17,354.2969 C6,385.7169 6.69,414.3169 32.17,446.2969 C64.09,486.3669 182.7387,509.2137 282.6287,522.0237 " fill="none" id="client-to-luovutuspalvelu" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="288.58,522.7869,280.1619,517.6746,283.6206,522.1509,279.1443,525.6096,288.58,522.7869" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199.1831" x="95.9864" y="367.3638">5. Vaihda "authorization code"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.5557" x="137.3001" y="382.4966">"access token":iin</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="193.5118" y="397.6294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324.8159" x="33.17" y="412.7622">{mtls-client-cert, grant_type=authorization_code,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194.251" x="98.4525" y="427.895">client_id, code, code_verifier}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129.5811" x="132.8536" y="443.0278">=&gt; {access_token}</text></g><!--link client to luovutuspalvelu--><g id="link_client_luovutuspalvelu"><path codeLine="49" d="M403.5,324.5569 C403.36,334.2669 403.24,344.6669 403.17,354.2969 C402.87,395.1869 398.9,405.6269 403.17,446.2969 C404.93,463.0469 407.1551,475.4173 410.7151,491.0173 " fill="none" id="client-to-luovutuspalvelu-1" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="412.05,496.8669,413.9474,487.2025,410.9376,491.9922,406.1479,488.9824,412.05,496.8669" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126.5596" x="448.3306" y="374.8638">6. Hae jaetut tiedot</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.2827" x="453.4691" y="389.9966">"access token":lla</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="509.5443" y="405.1294">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.7485" x="408.3023" y="420.2622">{mtls-client-cert, access_token}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71.7412" x="477.806" y="435.395">=&gt; {data}</text></g><!--SRC=[XLJDJjj04BxxAKQvDZPjMZX40WdrGXLQf4BfWI1hi8Taa_MkjRiEJL7U9i-G5_2BTNRjK2U4zcHxFVFzpTXEE4bmTLwvwG3Y9stcZr8_mUZgUlGbBb4kI5RMOXHzquu0BGZbZ8vWP1CuodLM5QGSEg7LaKOFaXHvH2e7nVLHL68snmarUF0SHPakIgsu1-RQpaNwm0M-_2w2bhGzYVYW5tJ187aF_aORyJjGWIMp8DFRBO7lP7LbCdfvVT_bavLULAwohQaEuzwRM4s4-kNvl_8fIhYvl8PC2W-IaN4GkqefORd3Cwow91LJDyZrUkbSlPxLwpqdF-mhQRuhvPZurlV-f8VOaaIX3hH2gDi3QDNvvejblScNgg5-8ypFeJnWxASIv_f9nMTxqnd2SHzEW7AIaaWjwhKKRcbPGaFC3HqFG_YGmFa24UP_K-16634eAN1ePXeB12V8wHcVR5L0RCMY6gknUcwGKv7tmL0k36KkhOpeGwPpIhCfCg2QK1zifak-t5bUGxfVHM44yRwYGG8tHDk1QvumlDlAsqWXd5iMzLh1d9VO8SmGK2baOIMELQD5U0ilahUzzKO5lPuj5dd3tzB61uBycC1blPuIfmBbqWzgCrOzt5blRx4t3B4KmjBSYYw53yJou2sbRbdIgQ_kGoUl9f6n-dTkkyzfGQmWFxqU79zqmjnLx_sq4n_2fuuHTaj62rV18ITZ5RQv84O5LqbQ84Vxg4q1fROSqzQFmk3pjUwEekt6iPJztUKjJU0MnJJ7DtJqCCl8Md2Q_VI6GZIpAvoqSGCS-o-y3nE376Q8TmSe3Mgs6n7IRkFtQV9FHpmACgknWjCpU6xOqi3s7-Kd2LmWyTwHgvpViboxLtgb30710S4xL2rzZWvNqHy0]--></g></svg>