<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Mocha tests</title>
    <link rel="stylesheet" href="css/mocha.css" media="all"/>
    <link rel="stylesheet" href="css/mocha-custom.css" media="all"/>
</head>
<body>
<div id="mocha"></div>
<script>
    // make sure Mocha fails on unhandled exceptions, even before Mocha has started (e.g. syntax errors in our test scripts)
    // window.uiError is checked in mocha before() and afterEach() hooks below
    console.log('adding window error handler!')
    window.onerror = function(errorMsg, url, lineNumber, columnNumber, exception) {
      window.uiError = arguments
      console.log(arguments)
      return true
    }
</script>
<script>console.log('loading lib/mocha.js')</script>
<script src="lib/mocha.js"></script>
<script>console.log('loading lib/chai.js')</script>
<script src="lib/chai.js"></script>
<script>console.log('loading lib/lodash.js')</script>
<script src="lib/lodash.js"></script>
<script>console.log('loading lib/q.js')</script>
<script src="lib/q.js"></script>
<script>console.log('loading lib/jquery.js')</script>
<script src="lib/jquery.js"></script>
<script>
    console.log('Setting up mocha')
    var testTimeoutPageLoad = 10000
    var testTimeoutDefault = 10000
    if (window.initMochaPhantomJS) {
      console.log('Calling window.initMochaPhantomJS')
      window.initMochaPhantomJS();
    }
    mocha.ui('bdd')
    mocha.reporter('html')
    mocha.timeout(testTimeoutPageLoad)

    function reportAndClearWindowUiError() {
      var err = window.uiError
      window.uiError = null
      expect(err || null ).to.be.null
    }
    before(reportAndClearWindowUiError)
    afterEach(reportAndClearWindowUiError)

    console.log('Mocha setup done')
</script>
<script>console.log('loading util/polyfills.js')</script>
<script src="util/polyfills.js"></script>
<script>console.log('loading util/testHelpers.js')</script>
<script src="util/testHelpers.js"></script>
<script>console.log('util/chaiEqualIgnoreNewlines.js')</script>
<script src="util/chaiEqualIgnoreNewlines.js"></script>
<script>console.log('loading doubles/fakePiwik.js')</script>
<script src="doubles/fakePiwik.js"></script>
<script>console.log('loading page/pageApi.js')</script>
<script src="page/pageApi.js"></script>
<script>console.log('loading page/organisaatioHaku.js')</script>
<script src="page/organisaatioHaku.js"></script>
<script>console.log('loading page/authentication.js')</script>
<script src="page/authentication.js"></script>
<script>console.log('loading page/loginPage.js')</script>
<script src="page/loginPage.js"></script>
<script>console.log('loading page/koskiPage.js')</script>
<script src="page/koskiPage.js"></script>
<script>console.log('loading page/addOppijaPage.js')</script>
<script src="page/addOppijaPage.js"></script>
<script>console.log('loading page/opinnotPage.js')</script>
<script src="page/opinnotPage.js"></script>
<script>console.log('loading page/todistusPage.js')</script>
<script src="page/todistusPage.js"></script>
<script>console.log('loading page/opintosuoritusotePage.js')</script>
<script src="page/opintosuoritusotePage.js"></script>
<script>console.log('loading page/documentationPage.js')</script>
<script src="page/documentationPage.js"></script>
<script>console.log('loading page/tiedonsiirrotPage.js')</script>
<script src="page/tiedonsiirrotPage.js"></script>
<script>console.log('loading page/omatTiedotPage.js')</script>
<script src="page/omatTiedotPage.js"></script>
<script>console.log('loading page/pulssiPage.js')</script>
<script src="page/pulssiPage.js"></script>
<script>console.log('loading page/raporttiPage.js')</script>
<script src="page/raporttiPage.js"></script>
<script>console.log('loading page/landingPage.js')</script>
<script src="page/landingPage.js"></script>
<script>console.log('loading spec/koskiSpec.js')</script>
<script src="spec/koskiSpec.js"></script>
<script>console.log('loading spec/piwikTrackingSpec.js')</script>
<script src="spec/piwikTrackingSpec.js"></script>
<script>console.log('loading spec/oppijahakuSpec.js')</script>
<script src="spec/oppijahakuSpec.js"></script>
<script>console.log('loading spec/oppijataulukkoSpec.js')</script>
<script src="spec/oppijataulukkoSpec.js"></script>
<script>console.log('loading spec/ammatillinenSpec.js')</script>
<script src="spec/ammatillinenSpec.js"></script>
<script>console.log('loading spec/esiopetusSpec.js')</script>
<script src="spec/esiopetusSpec.js"></script>
<script>console.log('loading spec/perusopetusSpec.js')</script>
<script src="spec/perusopetusSpec.js"></script>
<script>console.log('loading spec/lukioSpec.js')</script>
<script src="spec/lukioSpec.js"></script>
<script>console.log('loading spec/ibSpec.js')</script>
<script src="spec/ibSpec.js"></script>
<script>console.log('loading spec/ylioppilastutkintoSpec.js')</script>
<script src="spec/ylioppilastutkintoSpec.js"></script>
<script>console.log('loading spec/korkeakouluSpec.js')</script>
<script src="spec/korkeakouluSpec.js"></script>
<script>console.log('loading spec/telmaSpec.js')</script>
<script src="spec/telmaSpec.js"></script>
<script>console.log('loading spec/documentationSpec.js')</script>
<script src="spec/documentationSpec.js"></script>
<script>console.log('loading spec/tiedonsiirrotSpec.js')</script>
<script src="spec/tiedonsiirrotSpec.js"></script>
<script>console.log('loading spec/omatTiedotSpec.js')</script>
<script src="spec/omatTiedotSpec.js"></script>
<script>console.log('loading spec/pulssiSpec.js')</script>
<script src="spec/pulssiSpec.js"></script>
<script>console.log('loading spec/raporttiSpec.js')</script>
<script src="spec/raporttiSpec.js"></script>
<script>console.log('loading spec/localisointiSpec.js')</script>
<script src="spec/localisointiSpec.js"></script>
<script>console.log('loading spec/landingPageSpec.js')</script>
<script src="spec/landingPageSpec.js"></script>
<script>console.log('loading spec/muokkauspalkkiSpec.js')</script>
<script src="spec/muokkauspalkkiSpec.js"></script>
<script>console.log('loading lib/html2canvas.js')</script>
<script src="spec/sisaltyvaOpiskeluoikeusSpec.js"></script>
<script src="spec/linkitettyOppijaSpec.js"></script>
<script src="spec/oikeudetSpec.js"></script>
<script src="lib/html2canvas.js"></script>
<script>
    var runner = mocha.run()
    if (window.callPhantom) {
        console.log("PhantomJS mode")
    }

    runner.errors = []
    function mapError(e) {
      var logEntry = {
        title: e.title
      }
      if (e.err) logEntry.message = e.err.message
      if (e.parent) logEntry.parent = mapError(e.parent)
      return logEntry
    }
    runner.on("fail", function(e) {
      takeScreenshot(e.title)()
      runner.errors.push(mapError(e))
    })

    $(document).keyup(function(e) { 
      if(e.keyCode==27) {
          runner._abort = true
      }
    })
</script>
<iframe id="testframe"></iframe>
</body>
</html>
